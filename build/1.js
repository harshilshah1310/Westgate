webpackJsonp([1],{1873:function(n,e,t){"use strict";function s(n){return p._42(0,[(n()(),p._16(0,0,null,null,0,null,null,null,null,null,null,null))],null,null)}function l(n){return p._42(0,[(n()(),p._16(0,0,null,null,0,null,null,null,null,null,null,null))],null,null)}function a(n){return p._42(0,[(n()(),p._16(0,0,null,null,0,null,null,null,null,null,null,null))],null,null)}function o(n){return p._42(0,[(n()(),p._16(0,0,null,null,18,"ion-list",[],null,null,null,null,null)),p._15(1,16384,null,0,F.a,[$.a,p.p,p.K,H.a,G.l,z.a],null,null),(n()(),p._40(-1,null,["\n                "])),(n()(),p._11(16777216,null,null,2,null,s)),p._15(4,540672,null,0,j.r,[p.W],{ngTemplateOutletContext:[0,"ngTemplateOutletContext"],ngTemplateOutlet:[1,"ngTemplateOutlet"]},null),p._33(5,{item:0}),(n()(),p._40(-1,null,["\n                "])),(n()(),p._11(16777216,null,null,2,null,l)),p._15(8,540672,null,0,j.r,[p.W],{ngTemplateOutletContext:[0,"ngTemplateOutletContext"],ngTemplateOutlet:[1,"ngTemplateOutlet"]},null),p._33(9,{item:0}),(n()(),p._40(-1,null,["\n                "])),(n()(),p._11(16777216,null,null,2,null,a)),p._15(12,540672,null,0,j.r,[p.W],{ngTemplateOutletContext:[0,"ngTemplateOutletContext"],ngTemplateOutlet:[1,"ngTemplateOutlet"]},null),p._33(13,{item:0}),(n()(),p._40(-1,null,["\n                "])),(n()(),p._40(-1,null,["\n                "])),(n()(),p._16(16,0,null,null,1,"core-infinite-loading",[],null,[[null,"action"]],function(n,e,t){var s=!0,l=n.component;if("action"===e){s=!1!==l.search(l.query,"messages",t)&&s}return s},J.b,J.a)),p._15(17,573440,null,0,Z.a,[[2,Q.a]],{enabled:[0,"enabled"],error:[1,"error"]},{action:"action"}),(n()(),p._40(-1,null,["\n            "]))],function(n,e){var t=e.component;n(e,4,0,n(e,5,0,t.contacts),p._29(e.parent,45));n(e,8,0,n(e,9,0,t.nonContacts),p._29(e.parent,45));n(e,12,0,n(e,13,0,t.messages),p._29(e.parent,45));n(e,17,0,t.messages.canLoadMore,t.messages.loadMoreError)},null)}function i(n){return p._42(0,[(n()(),p._16(0,0,null,null,7,"ion-item",[["class","item item-block"],["text-wrap",""]],null,null,null,X.b,X.a)),p._15(1,1097728,null,3,Y.a,[nn.a,$.a,p.p,p.K,[2,en.a]],null,null),p._37(335544320,6,{contentLabel:0}),p._37(603979776,7,{_buttons:1}),p._37(603979776,8,{_icons:1}),p._15(5,16384,null,0,tn.a,[],null,null),(n()(),p._40(6,2,["\n        ","\n    "])),p._32(131072,sn.a,[ln.a,p.i])],null,function(n,e){n(e,6,0,p._41(e,6,0,p._29(e,7).transform(e.parent.context.item.emptyString)))})}function r(n){return p._42(0,[(n()(),p._16(0,0,null,null,2,"core-icon",[["name","fa-ban"]],null,null,null,an.b,an.a)),p._15(1,245760,null,0,on.a,[p.p],{name:[0,"name"],ariaLabel:[1,"ariaLabel"]},null),p._32(131072,sn.a,[ln.a,p.i])],function(n,e){n(e,1,0,"fa-ban",p._41(e,1,1,p._29(e,2).transform("addon.messages.contactblocked")))},null)}function u(n){return p._42(0,[(n()(),p._16(0,0,null,null,3,"ion-note",[],null,null,null,null,null)),p._15(1,16384,null,0,rn.a,[$.a,p.p,p.K],null,null),(n()(),p._40(2,null,["\n            ","\n        "])),p._34(3,1)],null,function(n,e){n(e,2,0,p._41(e,2,0,n(e,3,0,p._29(e.parent.parent.parent,0),e.parent.context.$implicit.lastmessagedate)))})}function c(n){return p._42(0,[(n()(),p._16(0,0,null,null,2,"span",[["class","addon-message-last-message-user"]],null,null,null,null,null)),(n()(),p._40(1,null,["",""])),p._32(131072,sn.a,[ln.a,p.i])],null,function(n,e){n(e,1,0,p._41(e,1,0,p._29(e,2).transform("addon.messages.you")))})}function d(n){return p._42(0,[(n()(),p._16(0,0,null,null,31,"a",[["class","addon-message-discussion item item-block"],["ion-item",""],["text-wrap",""]],[[8,"title",0],[2,"core-split-item-selected",null]],[[null,"click"]],function(n,e,t){var s=!0;if("click"===e){s=!1!==n.component.openConversation(n.context.$implicit)&&s}return s},X.b,X.a)),p._15(1,1097728,null,3,Y.a,[nn.a,$.a,p.p,p.K,[2,en.a]],null,null),p._37(335544320,9,{contentLabel:0}),p._37(603979776,10,{_buttons:1}),p._37(603979776,11,{_icons:1}),p._15(5,16384,null,0,tn.a,[],null,null),(n()(),p._40(-1,2,["\n        "])),(n()(),p._16(7,0,null,0,2,"ion-avatar",[["core-user-avatar",""],["item-start",""]],null,null,null,un.b,un.a)),p._15(8,770048,null,0,cn.a,[dn.a,I.a,hn.a,S.a,b.a],{user:[0,"user"],linkProfile:[1,"linkProfile"],checkOnline:[2,"checkOnline"]},null),p._15(9,16384,null,0,fn.a,[],null,null),(n()(),p._40(-1,2,["\n        "])),(n()(),p._16(11,0,null,2,7,"h2",[],null,null,null,null,null)),(n()(),p._40(-1,null,["\n            "])),(n()(),p._16(13,0,null,null,1,"core-format-text",[],null,null,null,null,null)),p._15(14,540672,null,0,gn.a,[p.p,I.a,M.a,_n.a,ln.a,H.a,hn.a,mn.a,pn.a,vn.a,S.a,bn.a,[2,dn.a],[2,Q.a],[2,C.a],In.a,b.a],{text:[0,"text"]},null),(n()(),p._40(-1,null,["\n            "])),(n()(),p._11(16777216,null,null,1,null,r)),p._15(17,16384,null,0,j.k,[p.W,p.T],{ngIf:[0,"ngIf"]},null),(n()(),p._40(-1,null,["\n        "])),(n()(),p._40(-1,2,["\n        "])),(n()(),p._11(16777216,null,2,1,null,u)),p._15(21,16384,null,0,j.k,[p.W,p.T],{ngIf:[0,"ngIf"]},null),(n()(),p._40(-1,2,["\n        "])),(n()(),p._16(23,0,null,2,7,"p",[["class","addon-message-last-message"]],null,null,null,null,null)),(n()(),p._40(-1,null,["\n            "])),(n()(),p._11(16777216,null,null,1,null,c)),p._15(26,16384,null,0,j.k,[p.W,p.T],{ngIf:[0,"ngIf"]},null),(n()(),p._40(-1,null,["\n            "])),(n()(),p._16(28,0,null,null,1,"core-format-text",[["class","addon-message-last-message-text"],["clean","true"],["singleLine","true"]],null,null,null,null,null)),p._15(29,540672,null,0,gn.a,[p.p,I.a,M.a,_n.a,ln.a,H.a,hn.a,mn.a,pn.a,vn.a,S.a,bn.a,[2,dn.a],[2,Q.a],[2,C.a],In.a,b.a],{text:[0,"text"],clean:[1,"clean"],singleLine:[2,"singleLine"]},null),(n()(),p._40(-1,null,["\n        "])),(n()(),p._40(-1,2,["\n    "]))],function(n,e){n(e,8,0,e.context.$implicit,!1,!0);n(e,14,0,e.context.$implicit.fullname);n(e,17,0,e.context.$implicit.isblocked);n(e,21,0,e.context.$implicit.lastmessagedate>0);n(e,26,0,e.context.$implicit.sentfromcurrentuser);n(e,29,0,e.context.$implicit.lastmessage,"true","true")},function(n,e){n(e,0,0,e.context.$implicit.fullname,e.context.$implicit==e.component.selectedResult)})}function h(n){return p._42(0,[(n()(),p._16(0,0,null,null,6,"div",[["padding-horizontal",""]],null,null,null,null,null)),(n()(),p._40(-1,null,["\n            "])),(n()(),p._16(2,0,null,null,3,"button",[["block",""],["color","light"],["ion-button",""]],null,[[null,"click"]],function(n,e,t){var s=!0,l=n.component;if("click"===e){s=!1!==l.search(l.query,n.parent.parent.context.item.type)&&s}return s},yn.b,yn.a)),p._15(3,1097728,null,0,Cn.a,[[8,""],$.a,p.p,p.K],{color:[0,"color"],block:[1,"block"]},null),(n()(),p._40(4,0,["\n                ","\n            "])),p._32(131072,sn.a,[ln.a,p.i]),(n()(),p._40(-1,null,["\n        "]))],function(n,e){n(e,3,0,"light","")},function(n,e){n(e,4,0,p._41(e,4,0,p._29(e,5).transform("core.loadmore")))})}function f(n){return p._42(0,[(n()(),p._16(0,0,null,null,4,"div",[["padding",""],["text-center",""]],null,null,null,null,null)),(n()(),p._40(-1,null,["\n            "])),(n()(),p._16(2,0,null,null,1,"ion-spinner",[],[[2,"spinner-paused",null]],null,null,Mn.b,Mn.a)),p._15(3,114688,null,0,Sn.a,[$.a,p.p,p.K],null,null),(n()(),p._40(-1,null,["\n        "]))],function(n,e){n(e,3,0)},function(n,e){n(e,2,0,p._29(e,3)._paused)})}function g(n){return p._42(0,[(n()(),p._16(0,0,null,null,7,null,null,null,null,null,null,null)),(n()(),p._40(-1,null,["\n        "])),(n()(),p._11(16777216,null,null,1,null,h)),p._15(3,16384,null,0,j.k,[p.W,p.T],{ngIf:[0,"ngIf"]},null),(n()(),p._40(-1,null,["\n        "])),(n()(),p._11(16777216,null,null,1,null,f)),p._15(6,16384,null,0,j.k,[p.W,p.T],{ngIf:[0,"ngIf"]},null),(n()(),p._40(-1,null,["\n    "]))],function(n,e){n(e,3,0,e.parent.context.item.canLoadMore&&!e.parent.context.item.loadingMore);n(e,6,0,e.parent.context.item.loadingMore)},null)}function _(n){return p._42(0,[(n()(),p._40(-1,null,["\n    "])),(n()(),p._16(1,0,null,null,7,"ion-item-divider",[["class","item item-divider"],["text-wrap",""]],null,null,null,X.b,X.a)),p._15(2,1097728,null,3,Y.a,[nn.a,$.a,p.p,p.K,[2,en.a]],null,null),p._37(335544320,3,{contentLabel:0}),p._37(603979776,4,{_buttons:1}),p._37(603979776,5,{_icons:1}),p._15(6,16384,null,0,En.a,[$.a,p.p,p.K],null,null),(n()(),p._40(7,2,["",""])),p._32(131072,sn.a,[ln.a,p.i]),(n()(),p._40(-1,null,["\n    "])),(n()(),p._11(16777216,null,null,1,null,i)),p._15(11,16384,null,0,j.k,[p.W,p.T],{ngIf:[0,"ngIf"]},null),(n()(),p._40(-1,null,["\n\n    "])),(n()(),p._40(-1,null,["\n    "])),(n()(),p._11(16777216,null,null,1,null,d)),p._15(15,802816,null,0,j.j,[p.W,p.T,p.v],{ngForOf:[0,"ngForOf"]},null),(n()(),p._40(-1,null,["\n\n    "])),(n()(),p._40(-1,null,["\n    "])),(n()(),p._11(16777216,null,null,1,null,g)),p._15(19,16384,null,0,j.k,[p.W,p.T],{ngIf:[0,"ngIf"]},null),(n()(),p._40(-1,null,["\n"]))],function(n,e){n(e,11,0,0==e.context.item.results.length);n(e,15,0,e.context.item.results);n(e,19,0,"messages"!=e.context.item.type)},function(n,e){n(e,7,0,p._41(e,7,0,p._29(e,8).transform(e.context.item.titleString)))})}function m(n){return p._42(0,[p._32(0,On.a,[pn.a,ln.a,Dn.a]),p._37(402653184,1,{splitviewCtrl:0}),(n()(),p._16(2,0,null,null,21,"ion-header",[],null,null,null,null,null)),p._15(3,16384,null,0,Un.a,[$.a,p.p,p.K,[2,Pn.a]],null,null),(n()(),p._40(-1,null,["\n    "])),(n()(),p._16(5,0,null,null,17,"ion-navbar",[["class","toolbar"],["core-back-button",""]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,xn.b,xn.a)),p._15(6,49152,null,0,kn.a,[Tn.a,[2,Pn.a],[2,dn.a],$.a,p.p,p.K],null,null),p._15(7,212992,null,0,wn.a,[kn.a,H.a,ln.a,b.a],null,null),(n()(),p._40(-1,3,["\n        "])),(n()(),p._16(9,0,null,3,3,"ion-title",[],null,null,null,Ln.b,Ln.a)),p._15(10,49152,null,0,Rn.a,[$.a,p.p,p.K,[2,qn.a],[2,kn.a]],null,null),(n()(),p._40(11,0,["",""])),p._32(131072,sn.a,[ln.a,p.i]),(n()(),p._40(-1,3,["\n        "])),(n()(),p._16(14,0,null,2,7,"ion-buttons",[["end",""]],null,null,null,null,null)),p._15(15,16384,null,1,Nn.a,[$.a,p.p,p.K,[2,qn.a],[2,kn.a]],null,null),p._37(603979776,2,{_buttons:1}),(n()(),p._40(-1,null,["\n            "])),(n()(),p._40(-1,null,["\n            "])),(n()(),p._16(19,0,null,null,1,"core-context-menu",[],null,null,null,Wn.b,Wn.a)),p._15(20,245760,null,0,An.a,[ln.a,Kn.a,p.p,M.a,[2,Vn.a],hn.a],null,null),(n()(),p._40(-1,null,["\n        "])),(n()(),p._40(-1,3,["\n    "])),(n()(),p._40(-1,null,["\n"])),(n()(),p._40(-1,null,["\n"])),(n()(),p._16(25,0,null,null,17,"core-split-view",[],null,null,null,Bn.b,Bn.a)),p._15(26,245760,[[1,4]],0,C.a,[[2,dn.a],p.p,Fn.a,H.a,ln.a],null,null),(n()(),p._40(-1,0,["\n    "])),(n()(),p._16(28,0,null,0,13,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,$n.b,$n.a)),p._15(29,4374528,null,0,Q.a,[$.a,H.a,z.a,p.p,p.K,Tn.a,Hn.a,p.D,[2,Pn.a],[2,dn.a]],null,null),(n()(),p._40(-1,1,["\n        "])),(n()(),p._16(31,0,null,1,1,"core-search-box",[["autocorrect","off"]],null,[[null,"onSubmit"],[null,"onClear"]],function(n,e,t){var s=!0,l=n.component;if("onSubmit"===e){s=!1!==l.search(t)&&s}if("onClear"===e){s=!1!==l.clearSearch(t)&&s}return s},Gn.b,Gn.a)),p._15(32,114688,null,0,zn.a,[ln.a,hn.a],{autocorrect:[0,"autocorrect"],spellcheck:[1,"spellcheck"],autoFocus:[2,"autoFocus"],lengthCheck:[3,"lengthCheck"],disabled:[4,"disabled"]},{onSubmit:"onSubmit",onClear:"onClear"}),(n()(),p._40(-1,1,["\n        "])),(n()(),p._16(34,0,null,1,6,"core-loading",[],null,null,null,jn.b,jn.a)),p._15(35,638976,null,0,Jn.a,[ln.a,p.p,b.a,hn.a],{hideUntil:[0,"hideUntil"],message:[1,"message"]},null),p._32(131072,sn.a,[ln.a,p.i]),(n()(),p._40(-1,0,["\n            "])),(n()(),p._11(16777216,null,0,1,null,o)),p._15(39,16384,null,0,j.k,[p.W,p.T],{ngIf:[0,"ngIf"]},null),(n()(),p._40(-1,0,["\n        "])),(n()(),p._40(-1,1,["\n    "])),(n()(),p._40(-1,0,["\n"])),(n()(),p._40(-1,null,["\n\n"])),(n()(),p._40(-1,null,["\n"])),(n()(),p._11(0,[["resultsTemplate",2]],null,0,null,_))],function(n,e){var t=e.component;n(e,7,0),n(e,20,0),n(e,26,0);n(e,32,0,"off",!1,!0,1,t.disableSearch);n(e,35,0,!t.displaySearching,p._41(e,35,1,p._29(e,36).transform("core.searching")));n(e,39,0,t.displayResults)},function(n,e){n(e,5,0,p._29(e,6)._hidden,p._29(e,6)._sbPadding);n(e,11,0,p._41(e,11,0,p._29(e,12).transform("addon.messages.searchcombined")));n(e,28,0,p._29(e,29).statusbarPadding,p._29(e,29)._hasRefresher)})}Object.defineProperty(e,"__esModule",{value:!0});var p=t(1),v=(t(0),t(9),t(4)),b=t(13),I=t(2),y=t(149),C=t(35),M=t(5),S=t(10),E=function(){function n(n,e,t,s,l){var a=this;this.appProvider=n,this.domUtils=e,this.messagesProvider=l,this.disableSearch=!1,this.displaySearching=!1,this.displayResults=!1,this.query="",this.contacts={type:"contacts",titleString:"addon.messages.contacts",emptyString:"addon.messages.searchnocontactsfound",results:[],canLoadMore:!1,loadingMore:!1},this.nonContacts={type:"noncontacts",titleString:"addon.messages.noncontacts",emptyString:"addon.messages.searchnononcontactsfound",results:[],canLoadMore:!1,loadingMore:!1},this.messages={type:"messages",titleString:"addon.messages.messages",emptyString:"addon.messages.searchnomessagesfound",results:[],canLoadMore:!1,loadingMore:!1,loadMoreError:!1},this.selectedResult=null,this.memberInfoObserver=t.on(y.a.MEMBER_INFO_CHANGED_EVENT,function(n){if(n.userBlocked||n.userUnblocked){var e=a.contacts.results.find(function(e){return e.id==n.userId});if(e)e.isblocked=n.userBlocked;else{var t=a.nonContacts.results.find(function(e){return e.id==n.userId});t&&(t.isblocked=n.userBlocked)}a.messages.results.forEach(function(e){e.userid==n.userId&&(e.isblocked=n.userBlocked)})}},s.getCurrentSiteId())}return n.prototype.clearSearch=function(){this.query="",this.displayResults=!1,this.splitviewCtrl.emptyDetails()},n.prototype.search=function(n,e,t){var s=this;this.appProvider.closeKeyboard(),this.query=n,this.disableSearch=!0,this.displaySearching=!e;var l=[],a=[],o=[],i=[],r=!1,u=!1,c=!1;if(!e||"contacts"==e||"noncontacts"==e){var d=e?y.a.LIMIT_SEARCH:y.a.LIMIT_INITIAL_USER_SEARCH,h=0;"contacts"==e?(h=this.contacts.results.length,this.contacts.loadingMore=!0):"noncontacts"==e&&(h=this.nonContacts.results.length,this.nonContacts.loadingMore=!0),l.push(this.messagesProvider.searchUsers(n,h,d).then(function(n){e&&"contacts"!=e||(a=n.contacts,r=n.canLoadMoreContacts),e&&"noncontacts"!=e||(o=n.nonContacts,u=n.canLoadMoreNonContacts)}))}if(!e||"messages"==e){h=0;"messages"==e&&(h=this.messages.results.length,this.messages.loadingMore=!0),l.push(this.messagesProvider.searchMessages(n,void 0,h).then(function(n){i=n.messages,c=n.canLoadMore}))}return Promise.all(l).then(function(){e||(s.contacts.results=[],s.nonContacts.results=[],s.messages.results=[]),s.displayResults=!0,e&&"contacts"!=e||((n=s.contacts.results).push.apply(n,a),s.contacts.canLoadMore=r),e&&"noncontacts"!=e||((t=s.nonContacts.results).push.apply(t,o),s.nonContacts.canLoadMore=u),e&&"messages"!=e||((l=s.messages.results).push.apply(l,i),s.messages.canLoadMore=c,s.messages.loadMoreError=!1),e||(s.contacts.results.length>0?s.openConversation(s.contacts.results[0],!0):s.nonContacts.results.length>0?s.openConversation(s.nonContacts.results[0],!0):s.messages.results.length>0&&s.openConversation(s.messages.results[0],!0));var n,t,l}).catch(function(n){s.domUtils.showErrorModalDefault(n,"addon.messages.errorwhileretrievingusers",!0),"messages"==e&&(s.messages.loadMoreError=!0)}).finally(function(){s.disableSearch=!1,s.displaySearching=!1,"contacts"==e?s.contacts.loadingMore=!1:"noncontacts"==e?s.nonContacts.loadingMore=!1:"messages"==e&&(s.messages.loadingMore=!1),t&&t()})},n.prototype.openConversation=function(n,e){if(void 0===e&&(e=!1),!e||this.splitviewCtrl.isOn()){this.selectedResult=n;var t={};n.conversationid?t.conversationId=n.conversationid:t.userId=n.id,this.splitviewCtrl.push("AddonMessagesDiscussionPage",t)}},n.prototype.ngOnDestroy=function(){this.memberInfoObserver&&this.memberInfoObserver.off()},n}(),O=t(25),D=t(30),U=t(104),P=t(1983),x=function(){return function(){}}(),k=t(1365),T=t(1366),w=t(1367),L=t(1368),R=t(1369),q=t(1370),N=t(1371),W=t(1372),A=t(1373),K=t(1376),V=t(1377),B=t(1378),F=t(88),$=t(7),H=t(15),G=t(39),z=t(32),j=t(8),J=t(352),Z=t(255),Q=t(26),X=t(31),Y=t(21),nn=t(20),en=t(29),tn=t(34),sn=t(28),ln=t(19),an=t(113),on=t(96),rn=t(209),un=t(208),cn=t(180),dn=t(22),hn=t(3),fn=t(179),gn=t(42),_n=t(11),mn=t(27),pn=t(6),vn=t(17),bn=t(18),In=t(37),yn=t(47),Cn=t(44),Mn=t(118),Sn=t(98),En=t(112),On=t(287),Dn=t(24),Un=t(447),Pn=t(38),xn=t(1374),kn=t(207),Tn=t(33),wn=t(676),Ln=t(1375),Rn=t(350),qn=t(253),Nn=t(448),Wn=t(82),An=t(71),Kn=t(66),Vn=t(70),Bn=t(449),Fn=t(67),$n=t(178),Hn=t(105),Gn=t(1397),zn=t(460),jn=t(50),Jn=t(49),Zn=p._14({encapsulation:2,styles:[],data:{}}),Qn=p._12("page-addon-messages-search",E,function(n){return p._42(0,[(n()(),p._16(0,0,null,null,1,"page-addon-messages-search",[],null,null,null,m,Zn)),p._15(1,180224,null,0,E,[S.a,M.a,b.a,I.a,y.a],null,null)],null,null)},{},{},[]),Xn=t(23),Yn=t(346),ne=t(347),ee=t(349),te=t(348),se=t(446),le=t(675),ae=t(254);t.d(e,"AddonMessagesSearchPageModuleNgFactory",function(){return oe});var oe=p._13(x,[],function(n){return p._25([p._26(512,p.n,p._6,[[8,[k.a,T.a,w.a,L.a,R.a,q.a,N.a,W.a,A.a,K.a,V.a,B.a,Qn]],[3,p.n],p.B]),p._26(4608,j.m,j.l,[p.x,[2,j.v]]),p._26(4608,Xn.x,Xn.x,[]),p._26(4608,Xn.d,Xn.d,[]),p._26(4608,Yn.b,Yn.a,[]),p._26(4608,ne.a,ne.b,[]),p._26(4608,ee.b,ee.a,[]),p._26(4608,te.b,te.a,[]),p._26(4608,ln.a,ln.a,[se.a,Yn.b,ne.a,ee.b,te.b,ln.b,ln.c]),p._26(512,j.b,j.b,[]),p._26(512,Xn.v,Xn.v,[]),p._26(512,Xn.i,Xn.i,[]),p._26(512,Xn.s,Xn.s,[]),p._26(512,le.a,le.a,[]),p._26(512,v.a,v.a,[]),p._26(512,D.a,D.a,[]),p._26(512,U.a,U.a,[]),p._26(512,O.a,O.a,[]),p._26(512,P.a,P.a,[]),p._26(512,le.b,le.b,[]),p._26(512,x,x,[]),p._26(256,ln.c,void 0,[]),p._26(256,ln.b,void 0,[]),p._26(256,ae.a,E,[])])})},1983:function(n,e,t){"use strict";t.d(e,"a",function(){return s});t(0),t(9),t(4),t(25),t(30),t(104),t(1984),t(1985),t(1986),t(1987);var s=function(){return function(){}}()},1984:function(n,e,t){"use strict";t.d(e,"a",function(){return l});t(0),t(9),t(4),t(13),t(2);var s=t(149),l=(t(5),t(3),t(10),t(235),function(){function n(n,e,t,l,a,o,i,r,u,c){var d=this;this.eventsProvider=n,this.messagesProvider=l,this.domUtils=a,this.appProvider=i,this.utils=u,this.loaded=!1,this.search={enabled:!1,showResults:!1,results:[],loading:"",text:""},this.search.loading=t.instant("core.searching"),this.loadingMessages=t.instant("core.loading"),this.siteId=e.getCurrentSiteId(),this.newMessagesObserver=n.on(s.a.NEW_MESSAGE_EVENT,function(n){if(n.userId&&d.discussions){var e=d.discussions.find(function(e){return e.message.user==n.userId});void 0===e?(d.loaded=!1,d.refreshData().finally(function(){d.loaded=!0})):(e.message.message=n.message,e.message.timecreated=n.timecreated)}},this.siteId),this.readChangedObserver=n.on(s.a.READ_CHANGED_EVENT,function(n){if(n.userId&&d.discussions){var e=d.discussions.find(function(e){return e.message.user==n.userId});void 0!==e&&(e.unread=!1,d.messagesProvider.invalidateConversations(d.siteId),d.messagesProvider.refreshUnreadConversationCounts(d.siteId))}},this.siteId),this.appResumeSubscription=r.resume.subscribe(function(){d.loaded&&(d.loaded=!1,d.refreshData())}),this.discussionUserId=o.get("discussionUserId")||!1,this.pushObserver=c.on("receive").subscribe(function(n){u.isFalseOrZero(n.notif)&&n.site==d.siteId&&d.refreshData(null,!1)})}return n.prototype.ngOnInit=function(){var n=this;this.discussionUserId&&this.gotoDiscussion(this.discussionUserId),this.fetchData().then(function(){!n.discussionUserId&&n.discussions.length>0&&n.gotoDiscussion(n.discussions[0].message.user,void 0,!0)})},n.prototype.refreshData=function(n,e){var t=this;void 0===e&&(e=!0);var s=[];return s.push(this.messagesProvider.invalidateDiscussionsCache(this.siteId)),e&&s.push(this.messagesProvider.invalidateUnreadConversationCounts(this.siteId)),this.utils.allPromises(s).finally(function(){return t.fetchData().finally(function(){n&&n.complete()})})},n.prototype.fetchData=function(){var n=this;this.loadingMessage=this.loadingMessages,this.search.enabled=this.messagesProvider.isSearchMessagesEnabled();var e=[];return e.push(this.messagesProvider.getDiscussions(this.siteId).then(function(e){var t=[];for(var s in e)e[s].unread=!!e[s].unread,t.push(e[s]);n.discussions=t.sort(function(n,e){return e.message.timecreated-n.message.timecreated})})),e.push(this.messagesProvider.getUnreadConversationCounts(this.siteId)),Promise.all(e).catch(function(e){n.domUtils.showErrorModalDefault(e,"addon.messages.errorwhileretrievingdiscussions",!0)}).finally(function(){n.loaded=!0})},n.prototype.clearSearch=function(){var n=this;this.loaded=!1,this.search.showResults=!1,this.search.text="",this.fetchData().finally(function(){n.loaded=!0})},n.prototype.searchMessage=function(n){var e=this;return this.appProvider.closeKeyboard(),this.loaded=!1,this.loadingMessage=this.search.loading,this.messagesProvider.searchMessages(n,void 0,void 0,void 0,this.siteId).then(function(n){e.search.showResults=!0,e.search.results=n.messages}).catch(function(n){e.domUtils.showErrorModalDefault(n,"addon.messages.errorwhileretrievingmessages",!0)}).finally(function(){e.loaded=!0})},n.prototype.gotoDiscussion=function(n,e,t){void 0===t&&(t=!1),this.discussionUserId=n;var l={discussion:n,onlyWithSplitView:t};e&&(l.message=e),this.eventsProvider.trigger(s.a.SPLIT_VIEW_LOAD_EVENT,l,this.siteId)},n.prototype.ngOnDestroy=function(){this.newMessagesObserver&&this.newMessagesObserver.off(),this.readChangedObserver&&this.readChangedObserver.off(),this.cronObserver&&this.cronObserver.off(),this.appResumeSubscription&&this.appResumeSubscription.unsubscribe(),this.pushObserver&&this.pushObserver.unsubscribe()},n}())},1985:function(n,e,t){"use strict";t.d(e,"a",function(){return a});t(0);var s=t(1),l=(t(9),t(13),t(2),t(149)),a=(t(5),function(){function n(n,e,t,a){var o=this;this.domUtils=n,this.messagesProvider=a,this.onUserSelected=new s.r,this.loaded=!1,this.canLoadMore=!1,this.loadMoreError=!1,this.contacts=[],this.onUserSelected=new s.r,this.memberInfoObserver=e.on(l.a.MEMBER_INFO_CHANGED_EVENT,function(n){if(n.userBlocked||n.userUnblocked){var e=o.contacts.find(function(e){return e.id==n.userId});e&&(e.isblocked=n.userBlocked)}else if(n.contactRemoved){var t=o.contacts.findIndex(function(e){return e.id==n.userId});t>=0&&o.contacts.splice(t,1)}else n.contactRequestConfirmed&&o.refreshData()},t.getCurrentSiteId())}return n.prototype.ngOnInit=function(){var n=this;this.fetchData().then(function(){n.contacts.length&&n.selectUser(n.contacts[0].id,!0)}).finally(function(){n.loaded=!0}),this.content.resize()},n.prototype.fetchData=function(n){var e=this;void 0===n&&(n=!1),this.loadMoreError=!1;var t=n?0:this.contacts.length;return(0===t?this.messagesProvider.invalidateUserContacts().catch(function(){}):Promise.resolve()).then(function(){return e.messagesProvider.getUserContacts(t)}).then(function(t){e.contacts=n?t.contacts:e.contacts.concat(t.contacts),e.canLoadMore=t.canLoadMore}).catch(function(n){e.loadMoreError=!0,e.domUtils.showErrorModalDefault(n,"addon.messages.errorwhileretrievingcontacts",!0)})},n.prototype.refreshData=function(n){return this.fetchData(!0).finally(function(){n&&n.complete()})},n.prototype.loadMore=function(n){return this.fetchData().finally(function(){n&&n()})},n.prototype.selectUser=function(n,e){void 0===e&&(e=!1),this.selectedUserId=n,this.onUserSelected.emit({userId:n,onInit:e})},n.prototype.ngOnDestroy=function(){this.memberInfoObserver&&this.memberInfoObserver.off()},n}())},1986:function(n,e,t){"use strict";t.d(e,"a",function(){return a});t(0);var s=t(1),l=(t(9),t(13),t(2),t(149)),a=(t(5),function(){function n(n,e,t,a){var o=this;this.domUtils=n,this.messagesProvider=a,this.onUserSelected=new s.r,this.loaded=!1,this.canLoadMore=!1,this.loadMoreError=!1,this.requests=[],this.memberInfoObserver=e.on(l.a.MEMBER_INFO_CHANGED_EVENT,function(n){if(n.contactRequestConfirmed||n.contactRequestDeclined){var e=o.requests.findIndex(function(e){return e.id==n.userId});e>=0&&o.requests.splice(e,1)}},t.getCurrentSiteId())}return n.prototype.ngOnInit=function(){var n=this;this.fetchData().then(function(){n.requests.length&&n.selectUser(n.requests[0].id,!0)}).finally(function(){n.loaded=!0}),this.content.resize()},n.prototype.fetchData=function(n){var e=this;void 0===n&&(n=!1),this.loadMoreError=!1;var t=n?0:this.requests.length;return(0===t?this.messagesProvider.invalidateContactRequestsCache().catch(function(){}):Promise.resolve()).then(function(){return e.messagesProvider.getContactRequests(t)}).then(function(t){e.requests=n?t.requests:e.requests.concat(t.requests),e.canLoadMore=t.canLoadMore}).catch(function(n){e.loadMoreError=!0,e.domUtils.showErrorModalDefault(n,"addon.messages.errorwhileretrievingcontacts",!0)})},n.prototype.refreshData=function(n){return this.messagesProvider.refreshContactRequestsCount(),this.fetchData(!0).finally(function(){n&&n.complete()})},n.prototype.loadMore=function(n){return this.fetchData().finally(function(){n&&n()})},n.prototype.selectUser=function(n,e){void 0===e&&(e=!1),this.selectedUserId=n,this.onUserSelected.emit({userId:n,onInit:e})},n.prototype.ngOnDestroy=function(){this.memberInfoObserver&&this.memberInfoObserver.off()},n}())},1987:function(n,e,t){"use strict";t.d(e,"a",function(){return l});t(0),t(9),t(4),t(2);var s=t(149),l=(t(5),t(10),t(13),function(){function n(n,e,t,l,a,o,i){var r=this;this.appProvider=t,this.messagesProvider=l,this.domUtils=a,this.eventsProvider=i,this.noSearchTypes=["online","offline","blocked","strangers"],this.loaded=!1,this.contactTypes=this.noSearchTypes,this.searchType="search",this.loadingMessage="",this.hasContacts=!1,this.contacts={search:[]},this.searchString="",this.currentUserId=n.getCurrentSiteUserId(),this.siteId=n.getCurrentSiteId(),this.searchingMessages=e.instant("core.searching"),this.loadingMessages=e.instant("core.loading"),this.loadingMessage=this.loadingMessages,this.discussionUserId=o.get("discussionUserId")||!1,this.memberInfoObserver=i.on(s.a.MEMBER_INFO_CHANGED_EVENT,function(n){n.contactRequestConfirmed&&r.refreshData()},n.getCurrentSiteId())}return n.prototype.ngOnInit=function(){var n=this;this.discussionUserId&&this.gotoDiscussion(this.discussionUserId),this.fetchData().then(function(){if(!n.discussionUserId&&n.hasContacts){var e=void 0;for(var t in n.contacts)if(n.contacts[t].length>0){e=n.contacts[t][0];break}e&&n.gotoDiscussion(e.id,!0)}}).finally(function(){n.loaded=!0})},n.prototype.refreshData=function(n){var e=this;return(this.searchString?this.performSearch(this.searchString):this.messagesProvider.invalidateAllContactsCache(this.currentUserId).then(function(){return e.fetchData()})).finally(function(){n.complete()})},n.prototype.fetchData=function(){var n=this;return this.loadingMessage=this.loadingMessages,this.messagesProvider.getAllContacts().then(function(e){for(var t in e)n.contacts[t]=e[t].length>0?n.sortUsers(e[t]):[];n.clearSearch()}).catch(function(e){n.domUtils.showErrorModalDefault(e,"addon.messages.errorwhileretrievingcontacts",!0)})},n.prototype.sortUsers=function(n){return n.sort(function(n,e){var t=n.fullname.toLowerCase(),s=e.fullname.toLowerCase();return t.localeCompare(s)})},n.prototype.clearSearch=function(){this.searchString="",this.contactTypes=this.noSearchTypes,this.hasContacts=!1;for(var n in this.contacts)if(this.contacts[n].length>0)return void(this.hasContacts=!0)},n.prototype.search=function(n){var e=this;return this.appProvider.closeKeyboard(),this.loaded=!1,this.loadingMessage=this.searchingMessages,this.performSearch(n).finally(function(){e.loaded=!0})},n.prototype.performSearch=function(n){var e=this;return this.messagesProvider.searchContacts(n).then(function(t){e.hasContacts=t.length>0,e.searchString=n,e.contactTypes=["search"],e.contacts.search=e.sortUsers(t)}).catch(function(n){e.domUtils.showErrorModalDefault(n,"addon.messages.errorwhileretrievingcontacts",!0)})},n.prototype.gotoDiscussion=function(n,e){void 0===e&&(e=!1),this.discussionUserId=n;this.eventsProvider.trigger(s.a.SPLIT_VIEW_LOAD_EVENT,{discussion:n,onlyWithSplitView:e},this.siteId)},n.prototype.ngOnDestroy=function(){this.memberInfoObserver&&this.memberInfoObserver.off()},n}())}});